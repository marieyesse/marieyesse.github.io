---
title: "REINVENT D4.4 Preliminary results"
author: "  TIMER_3_11, EU results " 
output: html_document
---

```{r setup, include=FALSE, echo=FALSE}

#######################################################################################################################
# THIS FILE: Analyses all the REINVENT narrative scenarios
# DATE: May 2020
#######################################################################################################################

# # Clear memory
# rm(list=ls()) # clear memory
# 
# # Working directory
# setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
# 
setwd("/mnt/y/Kennisbasis/IMAGE/model/users/mariesse/R/GitHub/marieyesse.github.io-master/marieyesse.github.io")
#######################################################################################################################
### Install and/or load required packages / dependencies
#######################################################################################################################

# Easy scripting packages.k
if(!require(dplyr)){install.packages("dplyr");   library(dplyr)}
if(!require(forcats)){install.packages("forcats");  library(forcats)}
if(!require(data.table)){install.packages("data.table");  library(data.table)}
if(!require(tidyr)){install.packages("tidyr");  library(tidyr)}
if(!require(fuzzyjoin)){install.packages("fuzzyjoin");  library(fuzzyjoin)}
if(!require(stringr)){install.packages("stringr");  library(stringr)}
if(!require(rlang)){install.packages("rlang");  library(rlang)}
if(!require(readr)){install.packages("readr");  library(readr)}

# text mining packages
if(!require(tidytext)){install.packages("tidytext");  library(tidytext)}
if(!require(tm)){install.packages("tm");  library(tm)}
if(!require(readxl)){install.packages("readxl");  library(readxl)}
if(!require(tabulizer)){install.packages("tabulizer");  library(tabulizer)}

# Social Media analysis
if(!require(rtweet)){install.packages("rtweet");  library(rtweet)}
if(!require(trendyy)){install.packages("trendyy");  library(trendyy)}
if(!require(gtrendsR)){install.packages("gtrendsR");  library(gtrendsR)}

# API reading and online toolng
if(!require(googledrive)){install.packages("googledrive");  library(googledrive)}
if(!require(googlesheets4)){install_github("tidyverse/googlesheets4");  library(googlesheets4)}
if(!require(rscopus)){install.packages("rscopus");  library(rscopus)}
#if(!require(orcid)){install.packages("orcid");  library(orcid)}
if(!require(scholar)){install.packages("scholar");  library(scholar)}

# maps
if(!require(grid)){install.packages("grid"); library(grid)}
if(!require(rworldmap)){install.packages("rworldmap");  library(rworldmap)}
if(!require(geosphere)){install.packages("geosphere"); library(geosphere)}
if(!require(gpclib)){install.packages("gpclib"); library(gpclib)}

# data visualisation packages
if(!require(ggplot2)){install.packages("ggplot2");  library(ggplot2)}
if(!require(ggforce)){install.packages("ggforce");  library(ggforce)}
if(!require(plotly)){install.packages("plotly");  library(plotly)}
if(!require(paletteer)){install.packages("paletteer");  library(paletteer)}
if(!require(ggrepel)){install.packages("ggrepel");  library(ggrepel)}
if(!require(igraph)){install.packages("igraph");  library(igraph)}
if(!require(ggraph)){install.packages("ggraph");  library(ggraph)}
if(!require(ggforce)){install.packages("ggforce");  library(ggforce)}
if(!require(shadowtext)){install.packages("shadowtext");  library(shadowtext)}
if(!require(gt)){install.packages("gt");  library(gt)}
#if(!require(animation)){install.packages("animation");  library(animation)}


# MyM cnversion packages
#if(!require(mym2r)){install_github("marieyesse/mym2r");  library(mym2r)}

#######################################################################################################################
### Functions (see repository "Timer_tools")
#######################################################################################################################

## Helper function "interpolate" 

interpolate <- function(df, startyear, endyear){
  df.intrapolate=seq(unique(df$Year)[1],endyear) 
  
  ## Activate data.table package ###
  dfreal=data.table(df)
  
  #Intrapolatie with approximate
  dfreal = dfreal[,list(approx(x=Year,y=value,xout=df.intrapolate)$y,
                        approx(x=Year,y=value,xout=df.intrapolate)$x),
                  by=eval(dput(names(dfreal[, -c("Year", "value")])))]
  
  setnames(dfreal,"V1","value")
  setnames(dfreal,"V2","Year")
  
  dfreal=data.table(dfreal)
  
}


cemis <- function(df, startyear, endyear){
  
  df.intrapolate=seq(unique(df$Year)[1],endyear) 
  
  ## Activate data.table package ###
  dfreal=data.table(df)
  
  #Intrapolatie with approximate
  dfreal = dfreal[,list(approx(x=Year,y=value,xout=df.intrapolate)$y,
                        approx(x=Year,y=value,xout=df.intrapolate)$x),
                  by=eval(dput(names(dfreal[, -c("Year", "value")])))]
  
  setnames(dfreal,"V1","value")
  setnames(dfreal,"V2","Year")
  
  dfreal=data.table(dfreal)
  
  df = dfreal[Year %in% c(startyear:endyear)] %>% 
    group_by_at(names(dfreal[, -c("Year", "value")])) %>% 
    mutate(CEMIS=cumsum(value)) 
  
  df = data.table(df)
  
}
```

```{r data, include=FALSE}

SCEN_xlsx <-list.files(path = "../../../../../harmensytze/Projects/REINVENT/7_Reporting_Tool/outxlsx/")


SCENSdat_list <- lapply(SCEN_xlsx, function(x){ 
    dat <- read_xlsx(path=paste("../../../../../harmensytze/Projects/REINVENT/7_Reporting_Tool/outxlsx/", x, sep=""))
    dat$Scenario <- x
    dat=data.table(dat)
    })

SCENdat <- rbindlist(SCENSdat_list, fill=TRUE) %>%
    drop_na(Model) %>%
    gather(Year, value, -c(Model, Scenario, Region, Variable, Unit)) %>%
    mutate(Year=as.numeric(Year), value=as.numeric(value)) %>%
    mutate(Scenario=gsub(".xlsx", "", Scenario, fixed=T)) %>%
    drop_na(Year) %>%
        bind_rows({.} %>% filter(Region %in% c("WEU", "CEU")) %>% 
                    group_by(Model, Scenario, Variable, Unit, Year) %>% 
                    summarise(value=sum(value)) %>%
                    mutate(Region="EU")) %>%
  filter(!Region == "World") %>%
    bind_rows({.} %>% filter(!Region %in% c( "EU")) %>% 
              group_by(Model, Scenario, Variable, Unit, Year) %>% 
              summarise(value=sum(value)) %>%
              mutate(Region="World")) %>%
  filter( !Scenario %in% c("SSP2_450"))#"SSP2_MaxTax", 

SCENINDUS <- SCENdat %>%
    filter(grepl("industry", tolower(Variable), fixed=T))

``` 

Produced on: `r format(Sys.time(), '%d %B %Y - time stamp: %H:%M')`

**Known issues**:

*	**Cement:** Hydrogen fired rotary kilns at end of century?
*	**Chemicals:** Final Energy should include bioenergy use?
*	**PPI:**: 
*	**Food:**  
*	**General:** No green hydrogen?

* Non-CO2/IMAGE-Land data not yet included

<font color="#cc0000"> This is preliminary work, please do not cite </font>


## Scenario assumptions {.tabset}

 <br>
 
### TechReplace

```{r scen-table-techreplace, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=5}

read_xlsx("../../../REINVENT_D4_4/Scenario_assumptions.xlsx") %>%
  data.table() %>%
  filter(Scenario=="TechReplace") %>%
  rename_all(make.names) %>%
  select(Focus, Sector, What, Starting.from, Convergence.to.year, Reference) %>%
  gt(
    rowname_col = "Focus",
    groupname_col = "Sector"
  ) %>%
  tab_header(title = "Scenario assumptions") %>%
  tab_spanner(
    label = "Changes to SSP2",
    columns = vars(`What`, `Starting.from`, `Convergence.to.year`, `Reference`)
  ) %>%
  fmt_markdown(
    columns = vars(`What`, `Starting.from`, `Convergence.to.year`, `Reference`)
  ) %>%
  tab_options(table.font.size = 12,
              table.align = "center",
              row_group.background.color = "#D3D3D3",
              row_group.font.size = 14,
              row_group.font.weight = "bold",
              table.width = pct(100),
              column_labels.font.weight = "bold",
              heading.title.font.size = 20,
              heading.title.font.weight = "bold")

``` 

 <br><br>


### ProcEff

```{r scen-table-proceff, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=5}

read_xlsx("../../../REINVENT_D4_4/Scenario_assumptions.xlsx") %>%
  data.table() %>%
  filter(Scenario=="ProcEff") %>%
  rename_all(make.names) %>%
    select(Focus, Sector, What, Starting.from, Convergence.to.year, Reference) %>%
  gt(
    rowname_col = "Focus",
    groupname_col = "Sector"
  ) %>%
  tab_header(title = "Scenario assumptions") %>%
  tab_spanner(
    label = "Changes to SSP2",
    columns = vars(`What`, `Starting.from`, `Convergence.to.year`, `Reference`)
  ) %>%
  fmt_markdown(
    columns = vars(`What`, `Starting.from`, `Convergence.to.year`, `Reference`)
  )%>%
  tab_options(table.font.size = 12,
              table.align = "center",
              row_group.background.color = "#D3D3D3",
              row_group.font.size = 14,
              row_group.font.weight = "bold",
              table.width = pct(100),
              column_labels.font.weight = "bold",
              heading.title.font.size = 20,
              heading.title.font.weight = "bold")

``` 


 <br><br>


### DemandMan

```{r scen-table-demandman, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=5}

read_xlsx("../../../REINVENT_D4_4/Scenario_assumptions.xlsx") %>%
  data.table() %>%
  filter(Scenario=="DemandMan") %>%
  rename_all(make.names) %>%
    select(Focus, Sector, What, Starting.from, Convergence.to.year, Reference) %>%
  gt(
    rowname_col = "Focus",
    groupname_col = "Sector"
  ) %>%
  tab_header(title = "Scenario assumptions") %>%
  tab_spanner(
    label = "Changes to SSP2",
    columns = vars(`What`, `Starting.from`, `Convergence.to.year`, `Reference`)
  ) %>%
  fmt_markdown(
    columns = vars(`What`, `Starting.from`, `Convergence.to.year`, `Reference`)
  ) %>%
  tab_options(table.font.size = 12,
              table.align = "center",
              row_group.background.color = "#D3D3D3",
              row_group.font.size = 14,
              row_group.font.weight = "bold",
              table.width = pct(100),
              column_labels.font.weight = "bold",
              heading.title.font.size = 20,
              heading.title.font.weight = "bold")

``` 

 <br><br>


### CircEco

```{r scen-table-circeco, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=5}

read_xlsx("../../../REINVENT_D4_4/Scenario_assumptions.xlsx") %>%
  data.table() %>%
  filter(Scenario=="CircEco") %>%
  rename_all(make.names) %>%
    select(Focus, Sector, What, Starting.from, Convergence.to.year, Reference) %>%
  gt(
    rowname_col = "Focus",
    groupname_col = "Sector"
  ) %>%
  tab_header(title = "Scenario assumptions") %>%
  tab_spanner(
    label = "Changes to SSP2",
    columns = vars(`What`, `Starting.from`, `Convergence.to.year`, `Reference`)
  ) %>%
  fmt_markdown(
    columns = vars(`What`, `Starting.from`, `Convergence.to.year`, `Reference`)
  ) %>%
  tab_options(table.font.size = 12,
              table.align = "center",
              row_group.background.color = "#D3D3D3",
              row_group.font.size = 14,
              row_group.font.weight = "bold",
              table.width = pct(100),
              column_labels.font.weight = "bold",
              heading.title.font.size = 20,
              heading.title.font.weight = "bold")

``` 

 <br><br>

## General {.tabset}


### Whole system emissions

```{r econ-emis, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=5}

ECONCO2 <- SCENdat %>%
    filter(grepl("Emissions|CO2", Variable, fixed=T)) 

ECONCO2Tot <-   ECONCO2 %>%
    #filter(grepl("emissions", tolower(Variable), fixed=T)) %>%
    filter(!grepl("Emissions|CO2|",Variable, fixed=T)) %>%
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_line(aes(x=Year, y=value,  group=Scenario, colour=Scenario)) +
     labs(title="CO2 Emissions",
        x="Year",
        y="MtCO2/yr") +
    facet_wrap(~ Variable, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(ECONCO2Tot)

```

### Cumulative emissions

```{r econ-emis-cumu, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=5}

ECONCO2 <- SCENdat %>%
    filter(grepl("Emissions|CO2", Variable, fixed=T)) 

ECONCO2Tot <-   ECONCO2 %>%
    #filter(grepl("emissions", tolower(Variable), fixed=T)) %>%
    filter(!grepl("Emissions|CO2|",Variable, fixed=T)) %>%
    filter(Region=="EU" ) %>%
  cemis(., 2010, 2100) %>%
    ggplot()+
    geom_line(aes(x=Year, y=CEMIS,  group=Scenario, colour=Scenario)) +
     labs(title="Cumulative CO2 Emissions between 2010 and 2100",
        x="Year",
        y="MtCO2/yr") +
    facet_wrap(~ Variable, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(ECONCO2Tot)

```


### Sectoral emissions

```{r dem-emis, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=10}

INDUSDEM <- SCENdat %>%
    filter(grepl("Emissions|CO2|Fossil Fuels and Industry|Energy Demand|", Variable, fixed=T)) %>%
  bind_rows(SCENdat %>%
              filter(grepl("Emissions|CO2|Fossil Fuels and Industry|Energy Supply|Electricity", Variable, fixed=T)) )

INDUSDEMTot <-   INDUSDEM %>%
    #filter(grepl("emissions", tolower(Variable), fixed=T)) %>%
    #filter(!grepl("cokes", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Z", "A", "Industry", "TMI"), sep = "[|]") %>%
  filter(is.na(TMI)==T) %>%
    filter(Region=="EU" ) %>%

    ggplot()+
    geom_line(aes(x=Year, y=value,  group=Scenario, colour=Scenario)) +
     labs(title="CO2 Emissions",
        x="Year",
        y="MtCO2/yr") +
    facet_wrap(~ Industry, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(INDUSDEMTot)

```

### Cumulative Sectoral emissions

```{r demsec-emis-cumu, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=5}

INDUSDEM <- SCENdat %>%
    filter(grepl("Emissions|CO2|Fossil Fuels and Industry|Energy Demand|", Variable, fixed=T)) %>%
  bind_rows(SCENdat %>%
              filter(grepl("Emissions|CO2|Fossil Fuels and Industry|Energy Supply|Electricity", Variable, fixed=T)) )

INDUSDEMbudget <-   INDUSDEM %>%
    #filter(grepl("emissions", tolower(Variable), fixed=T)) %>%
    #filter(!grepl("cokes", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Z", "A", "Industry", "TMI"), sep = "[|]") %>%
  filter(is.na(TMI)==T) %>%
    filter(Region=="EU" ) %>%
    group_by(Industry) %>%
  cemis(., 2010, 2100) %>%
    ggplot()+
    geom_line(aes(x=Year, y=CEMIS,  group=Scenario, colour=Scenario)) +
     labs(title="CO2 Emissions",
        x="Year",
        y="MtCO2/yr") +
    facet_wrap(~ Industry, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(INDUSDEMbudget)

```



## Steel {.tabset}

### CO2 Emissions

```{r steel-emis, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=5}

SCENSTEEL <- SCENdat %>%
    filter(grepl("steel", tolower(Variable), fixed=T)) 

SCENSTEELEMIS <-   SCENSTEEL %>%
    filter(grepl("emissions", tolower(Variable), fixed=T)) %>%
    filter(!grepl("cokes", tolower(Variable), fixed=T)) %>%
      filter(grepl("direct", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Type"), sep = "[|]") %>%
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_line(aes(x=Year, y=value, colour=Scenario, group=Scenario)) +
     labs(title="CO2 Emissions",
        x="Year",
        y="MtCO2/yr") +
    facet_wrap(~ Type, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENSTEELEMIS)

```

### Material Demand


```{r steel-material, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=7}

SCENSTEEL<- SCENdat %>%
    filter(grepl("steel", tolower(Variable), fixed=T)) 

SCENSTEELProd <-   SCENSTEEL %>%
    filter(grepl("production", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Material"), sep = "[|]") %>%
  
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_area(data=. %>% filter(!grepl("scrap", tolower(Material), fixed=T)), aes(x=Year, y=value, fill=Material), position="stack", colour="black") +
    geom_area(data=. %>% filter(grepl("scrap", tolower(Material), fixed=T)), aes(x=Year, y=value, fill=Material), position="stack", colour="black") +

     labs(title="Production",
        x="Year",
        y="Mt/Yr") +
    facet_wrap(~ Scenario, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENSTEELProd)

```

### Capacity / Feedstock


```{r Steel, include=TRUE, results=TRUE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=9, fig.height=7}

##############################################################################################################################
## Read input data
##############################################################################################################################



SCENSTEEL <- SCENdat %>%
    filter(grepl("steel", tolower(Variable), fixed=T)) 

 SCENSTEELCAP <-   SCENSTEEL %>%
    filter(grepl("capacity", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Technology"), sep = "[|]") %>%
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_area(aes(x=Year, y=value, fill=Technology), position="stack", colour="black") +
   labs(title="Capacity",
        x="Year",
        y="Mt/yr") +
    facet_wrap(~ Scenario, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENSTEELCAP)

```

### Final Energy


```{r steel-energy, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=7}


SCENSTEEL <- SCENdat %>%
    filter(grepl("steel", tolower(Variable), fixed=T)) 

SCENSTEELFINE <-   SCENSTEEL %>%
    filter(grepl("final energy", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Carrier"), sep = "[|]") %>%
  filter(!is.na(Carrier)==T) %>%
  
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_area(aes(x=Year, y=value, fill=Carrier), position="stack", colour="black") +
     labs(title="Final Energy Use",
        x="Year",
        y="EJ/yr") +
    facet_wrap(~ Scenario, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENSTEELFINE)

```



## Cement {.tabset}


### CO2 Emissions

```{r ce-emis, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=5}

SCENCE <- SCENdat %>%
    filter(grepl("cement", tolower(Variable), fixed=T)) 

SCENCEEMIS <-   SCENCE %>%
    filter(grepl("emissions", tolower(Variable), fixed=T)) %>%
      filter(grepl("direct", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Type"), sep = "[|]") %>%
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_line(aes(x=Year, y=value, colour=Scenario, group=Scenario)) +
     labs(title="CO2 Emissions",
        x="Year",
        y="MtCO2/yr") +
    facet_wrap(~ Type, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENCEEMIS)

```

### Material Demand

Demand seems to slowly increase again in DemandMan

```{r ce-material, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=7}

SCENCE<- SCENdat %>%
    filter(grepl("non metallic", tolower(Variable), fixed=T)) 

SCENCEProd <-   SCENCE %>%
    filter(grepl("production", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Material"), sep = "[|]") %>%
  
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_area(aes(x=Year, y=value, fill=Material), position="stack", colour="black") +
     labs(title="Production",
        x="Year",
        y="Mt/Yr") +
    facet_wrap(~ Scenario, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENCEProd)
```

### Capacity

```{r cement, include=TRUE, results=TRUE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=12, fig.height=7}

##############################################################################################################################
## Read input data
##############################################################################################################################



SCENCE <- SCENdat %>%
    filter(grepl("non metallic mineral", tolower(Variable), fixed=T)) 

 SCENCECAP <-   SCENCE %>%
    filter(grepl("capacity", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Technology"), sep = "[|]") %>%
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_area(aes(x=Year, y=value, fill=Technology), position="stack", colour="black") +
   labs(title="Capacity",
        x="Year",
        y="Mt/yr") +
    facet_wrap(~ Scenario, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENCECAP)

```


### Final Energy
```{r ce-energy, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=7}

SCENCE <- SCENdat %>%
    filter(grepl("non metallic mineral", tolower(Variable), fixed=T)) 

SCENCEFINE <-   SCENCE %>%
    filter(grepl("final energy", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Carrier"), sep = "[|]") %>%
  filter(!is.na(Carrier)==T) %>%
  
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_area(aes(x=Year, y=value, fill=Carrier), position="stack", colour="black") +
     labs(title="Final Energy Use",
        x="Year",
        y="EJ/yr") +
    facet_wrap(~ Scenario, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENCEFINE)

```



## Chemical Industry {.tabset}



### CO2 Emissions

```{r nonen-emis, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=5}

SCENCHEM <- SCENdat %>%
    filter(grepl("chemicals and petrochemicals", tolower(Variable), fixed=T)) 

SCENCHEMEMIS <-   SCENCHEM %>%
    filter(grepl("emissions", tolower(Variable), fixed=T)) %>%
    filter(grepl("direct", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Type", "Z"), sep = "[|]") %>%
  
  filter(grepl("hvc", tolower(Type), fixed=T)) %>%
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_line(aes(x=Year, y=value, colour=Scenario, group=Scenario)) +
     labs(title="Total CO2 Emissions",
        x="Year",
        y="MtCO2/yr") +
    facet_wrap(~ Z, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENCHEMEMIS)
 
 SCENCHEMEMIS2 <-   SCENCHEM %>%
    filter(grepl("emissions", tolower(Variable), fixed=T)) %>%
    filter(grepl("direct", tolower(Variable), fixed=T))  %>%
    separate(Variable, c("X", "Y", "Industry", "Type", "Z"), sep = "[|]") %>%
    filter(Region=="EU" & Z=="Direct emissions" ) %>%
   ggplot()+
    geom_area(aes(x=Year, y=value, fill=Type), position="stack", colour="black") +
     labs(title="Sectoral CO2 emissions",
        x="Year",
        y="MtCO2/yr") +
    facet_wrap(~ Scenario, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENCHEMEMIS2)

```


<!-- ### Material Demand -->


<!-- ```{r nonen-material, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=11} -->

<!-- SCENCHEM <- SCENdat %>% -->
<!--     filter(grepl("Production|Industry|Chemical|", Variable, fixed=T))  -->

<!-- SCENCHEMProd <-   SCENCHEM %>% -->
<!--     #filter(grepl("production", tolower(Variable), fixed=T)) %>% -->
<!--     #separate(Variable, c("X", "Y", "Industry", "Material"), sep = "[|]") %>% -->
<!--   mutate(Variable=gsub("Production|Industry|Chemical|", "", Variable, fixed=T)) %>%   -->
<!--     filter(Region=="EU" ) %>% -->
<!--   bind_rows({.} %>% filter(grepl("HVC", Variable)) %>% -->

<!--               spread(Variable,value) %>% -->
<!--               rename_all(make.names) %>% -->
<!--               mutate(HVC.Virgin.Production=(HVC.Total.Demand-HVC.Mechanical.recycling-HVC.Chemical.recycling)) %>% -->
<!--               select(-HVC.Total.Demand, -HVC.Mechanical.recycling, -HVC.Chemical.recycling) %>% -->
<!--               gather(Variable, value, c(HVC.Virgin.Production))) %>% -->
<!--   filter(!grepl("Total", Variable)) %>% -->
<!--     ggplot()+ -->
<!--     geom_area( aes(x=Year, y=value, fill=Variable), position="stack", colour="black") + -->
<!--     geom_area(aes(x=Year, y=value, fill=Variable), position="stack", colour="black") + -->

<!--      labs(title="Production", -->
<!--         x="Year", -->
<!--         y="GJ prod/Yr") + -->
<!--     facet_wrap(~ Scenario, ncol=2) + -->
<!--          theme(axis.text.x = element_text(angle=45, hjust=1), -->
<!--                text = element_text(size=14)) -->

<!--  ggplotly(SCENCHEMProd) -->

<!-- ``` -->


### Feedstock

```{r Chemical, results=TRUE, message=FALSE, warning=FALSE, echo=FALSE, fig.width=9, fig.height=7}

SCENCHEM <- SCENdat %>%
    filter(grepl("chemicals and petrochemicals", tolower(Variable), fixed=T)) 

SCENCHEMCAP <-   SCENCHEM %>%
    filter(grepl("feedstock energy", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Technology"), sep = "[|]") %>%
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_area(aes(x=Year, y=value, fill=Technology), position="stack", colour="black") +
     labs(title="Non-energy demand",
        x="Year",
        y="EJ/yr") +
    facet_wrap(~ Scenario, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENCHEMCAP)
```

### Final Energy


```{r nonen-procenergy, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=7}

SCENNONEN <- SCENdat %>%
    filter(grepl("chemicals and petrochemicals", tolower(Variable), fixed=T)) 

SCENNONENFINEproc <-   SCENNONEN %>%
    filter(grepl("process energy", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Carrier"), sep = "[|]") %>%
  filter(!is.na(Carrier)==T) %>%
  
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_area(aes(x=Year, y=value, fill=Carrier), position="stack", colour="black") +
     labs(title="Process Energy Use (Steam Cracking)",
        x="Year",
        y="EJ/yr") +
    facet_wrap(~ Scenario, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENNONENFINEproc)

```


```{r nonen-energy, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=7}

SCENNONEN <- SCENdat %>%
    filter(grepl("chemicals and petrochemicals", tolower(Variable), fixed=T)) 

SCENNONENFINE <-   SCENNONEN %>%
    filter(grepl("final energy", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Carrier"), sep = "[|]") %>%
  filter(!is.na(Carrier)==T) %>%
  
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_area(aes(x=Year, y=value, fill=Carrier), position="stack", colour="black") +
     labs(title="Final Energy Use",
        x="Year",
        y="EJ/yr") +
    facet_wrap(~ Scenario, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENNONENFINE)

```



## Pulp & Paper Industry {.tabset}

### CO2 Emissions


```{r ppi-emis, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=5}

SCENPPI <- SCENdat %>%
    filter(grepl("pulp and paper", tolower(Variable), fixed=T)) 

SCENPPIEMIS <-   SCENPPI %>%
    filter(grepl("emissions", tolower(Variable), fixed=T)) %>%
      filter(grepl("direct", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Type"), sep = "[|]") %>%
  
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_line(aes(x=Year, y=value, colour=Scenario, group=Scenario)) +
     labs(title="CO2 Emissions",
        x="Year",
        y="MtCO2/yr") +
    facet_wrap(~ Type, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENPPIEMIS)

```

### Material Demand


```{r ppi-material, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=7}

SCENPPI <- SCENdat %>%
    filter(grepl("pulp and paper", tolower(Variable), fixed=T))

SCENPPIProd <-   SCENPPI %>%
    filter(grepl("production", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Product"), sep = "[|]") %>%
  mutate(Group=case_when(grepl("Pulp", Product) ~ "Pulp",
                         grepl("print|board", tolower(Product)) ~ "Paper",
                         TRUE ~ "Recovered")) %>%
  filter(!Product=="Total") %>%
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_area(aes(x=Year, y=value, fill=Product), position="stack", colour="black") +
     labs(title="Production",
        x="Year",
        y="Mt/Yr") +
    facet_grid(Scenario~Group) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENPPIProd)
```


### Capacity / Feedstock

```{r ppi, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=11, fig.height=7}

SCENPPI <- SCENdat %>%
    filter(grepl("pulp and paper", tolower(Variable), fixed=T)) 

SCENPPICAP <-   SCENPPI %>%
    filter(grepl("capacity", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Type", "Technology", "Carrier"), sep = "[|]") %>%
  mutate(Technology=paste(Technology, Carrier)) %>%
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_area(aes(x=Year, y=value, fill=Technology), position="stack", colour="black") +
     labs(title="Energy demand",
        x="Year",
        y="MWth") +
    facet_grid(Type~ Scenario) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENPPICAP)
```

### Final Energy

```{r ppi-energy, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=7}

SCENPPI <- SCENdat %>%
    filter(grepl("pulp and paper", tolower(Variable), fixed=T)) 

SCENPPIFINE <-   SCENPPI %>%
    filter(grepl("final energy", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Carrier"), sep = "[|]") %>%
  filter(!is.na(Carrier)==T) %>%
  
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_area(aes(x=Year, y=value, fill=Carrier), position="stack", colour="black") +
     labs(title="Final Energy Use",
        x="Year",
        y="EJ/yr") +
    facet_wrap(~ Scenario, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENPPIFINE)

```




## Food Industry {.tabset}

### CO2 Emissions

```{r food-emis, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=5}

SCENFOOD <- SCENdat %>%
    filter(grepl("food", tolower(Variable), fixed=T)) 

SCENFOODEMIS <-   SCENFOOD %>%
    filter(grepl("emissions", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Type"), sep = "[|]") %>%
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_line(aes(x=Year, y=value, colour=Scenario, group=Scenario)) +
     labs(title="CO2 Emissions",
        x="Year",
        y="MtCO2/yr") +
    facet_wrap(~ Type, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENFOODEMIS)

```

### Material Demand

#### Minor

```{r food-materialmin, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=7}

SCENFood <- SCENdat %>%
    filter(grepl("food", tolower(Variable), fixed=T)) 

SCENFoodProd <-   SCENFood %>%
    filter(grepl("production", tolower(Variable), fixed=T)) %>%
    filter(grepl("minor", tolower(Variable), fixed=T) & !grepl("dairy", tolower(Variable))) %>%
    separate(Variable, c("X", "Y", "Industry", "Z", "Food"), sep = "[|]") %>%
    filter(Region=="EU" & !Food=="Meat" ) %>%
    ggplot()+
    geom_area(aes(x=Year, y=value, fill=Food), position="stack", colour="black") +
     labs(title="Production animal-protein",
        x="Year",
        y="Mt/Yr") +
    facet_wrap(~ Scenario, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENFoodProd)
```

#### Major

```{r food-materialmaj, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=7}

SCENFood <- SCENdat %>%
    filter(grepl("food", tolower(Variable), fixed=T)) 

SCENFoodProd <-   SCENFood %>%
    filter(grepl("production", tolower(Variable), fixed=T)) %>%
    filter(grepl("major", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Z", "Food"), sep = "[|]") %>%
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_area(aes(x=Year, y=value, fill=Food), position="stack", colour="black") +
     labs(title="Production animal & plant-based proteins",
        x="Year",
        y="Mt/Yr") +
    facet_wrap(~ Scenario, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENFoodProd)
 
```



### Capacity / Feedstock

```{r food, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=11, fig.height=7}

SCENFood <- SCENdat %>%
    filter(grepl("food", tolower(Variable), fixed=T)) 

SCENFoodCAP <-   SCENFood %>%
    filter(grepl("capacity", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Z", "Type", "Technology", "Carrier"), sep = "[|]") %>%
  mutate(Technology=paste(Technology, Carrier)) %>%
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_area(aes(x=Year, y=value, fill=Technology), position="stack", colour="black") +
     labs(title="Energy demand",
        x="Year",
        y="MWth") +
    facet_grid(Type~ Scenario) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENFoodCAP)
```

### Final Energy

```{r food-energy, echo=FALSE, results=TRUE, message=FALSE, warning=FALSE, fig.width=9, fig.height=7}

SCENFOOD <- SCENdat %>%
    filter(grepl("food", tolower(Variable), fixed=T)) 

SCENFOODFINE <-   SCENFOOD %>%
    filter(grepl("final energy", tolower(Variable), fixed=T)) %>%
   filter(!grepl("electricity|", tolower(Variable), fixed=T)) %>%
  filter(!grepl("heat|", tolower(Variable), fixed=T)) %>%
    separate(Variable, c("X", "Y", "Industry", "Carrier"), sep = "[|]") %>%
  filter(!is.na(Carrier)==T) %>%
  
    filter(Region=="EU" ) %>%
    ggplot()+
    geom_area(aes(x=Year, y=value, fill=Carrier), position="stack", colour="black") +
     labs(title="Final Energy Use",
        x="Year",
        y="EJ/yr") +
    facet_wrap(~ Scenario, ncol=2) +
         theme(axis.text.x = element_text(angle=45, hjust=1),
               text = element_text(size=14))

 ggplotly(SCENFOODFINE)

```


