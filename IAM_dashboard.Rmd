---
title: "Model intercomparison"
output: 
  html_document:
    includes:
      after_body: footer.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(reshape)
library(reshape2)
library(plyr)
library(dplyr)
library(data.table)
library(knitr)
library(tidyr)


# Plotting packages
library(ggplot2)
library(grid)
library(gridExtra)
library(plotly)
library(DT)

```


``` {r results=TRUE, message=FALSE, warning=FALSE, echo=FALSE}

#################
################################################################################
# Integrate with EMF28 models
## INSERT EU ROUNDTABLE COUNTRIES OF EMF28 MODELING
EMF280  = read.csv("data/EMF28_data.csv", sep=",", dec=".")
EMF28melt= melt(EMF280, id.vars=c("model","Scenario", "Region","Variable", "Unit"), variable.name="Year")
EMF28melt$Year = as.numeric(substr(EMF28melt$Year, 2, stop=100))
EMF28melt$value = as.numeric(EMF28melt$value)
setnames(EMF28melt, "model", "Model")
EMF28melt=data.table(EMF28melt)
EMF28meltEU=EMF28melt[Region=="EU27"]

EMF28meltEUBL=EMF28meltEU[Scenario=="EU1"]
EMF28meltEUBL$Scenario <- NULL
setnames(EMF28meltEUBL, "value", "BL")
EMF28meltEUBLY=EMF28meltEU[Year=="2010"]
setnames(EMF28meltEUBLY, "value", "Y2005")
EMF28meltEUBLY$Year <- NULL

EMF28meltEU=merge(EMF28meltEU, EMF28meltEUBL, by=c("Model", "Region", "Variable", "Unit", "Year"))
EMF28meltEU=merge(EMF28meltEU, EMF28meltEUBLY, by=c("Model", "Scenario", "Region", "Variable", "Unit"))

EMF28meltEU.stand=EMF28meltEU %>% mutate(ByBL=(value/BL)*100, ByY=(value/Y2005)*100)
EMF28meltEU.stand=data.table(EMF28meltEU.stand)

EMF28meltEU.stand$Variable <- gsub("|Fossil Fuels and industry|Energy Demand", "", EMF28meltEU.stand$Variable, fixed=FALSE)
EMF28meltEU.stand$Study <- "Förster et al. (2013)"
##
EMF28meltEU.minmaxBL=EMF28meltEU.stand[,list(ymax=max(ByBL,na.rm = TRUE),ymin=min(ByBL,na.rm = TRUE)),by=c("Scenario", "Variable", "Year", "Study")]
EMF28meltEU.minmaxY=EMF28meltEU.stand[,list(ymax=max(ByY,na.rm = TRUE),ymin=min(ByY,na.rm = TRUE)),by=c("Scenario", "Variable", "Year", "Study")]

# IEA Energy Technology Perspectives 2017 (EU, CO2 emissions, MtCO2)
EIAETP2017ghg=data.table(
  Year=c(	2014,	2025,	2030,	2035,	2040,	2045,	2050,	2055,	2060),
  n2DS=c(	535.166435835586,	494.243229509687,	402.598311905768,	345.858566149151,	301.310149855724,	262.85707389194,	231.279854216602,	197.42903537661,	167.520926650679),
  BL=c(	535.166435835586,	533.185107488493,	498.247226970959,	459.317685973749,	413.537508445583,	385.525348635476,	362.539840830355,	329.506642853231,	304.095658444859),
  B2DS=c(	535.166435835586,	414.816202772753,	333.193958766128,	254.828917832113,	212.188349670598,	180.716638364295,	145.718337436352,	117.999763292729,	88.7911258076458)
)
EIAETP2017ghg$Variable <- "Emissions|CO2|||Industry" # in MtCO2

EIAETP2017tfec=data.table(
        Year=c(	2014,	2025,	2030,	2035,	2040,	2045,	2050,	2055,	2060),
        n2DS=c(	15719.4132806439,	15297.3166533884,	13949.7140490422,	12969.0889812852,	12350.7704481325,	11650.4610078419,	11202.8463892211,	11012.3219688063,	10826.1448938142),
        BL=c(	15719.4132806439,	15550.6147880395,	14939.6110204016,	14265.5276270116,	13424.5816957318,	12923.0681629053,	12385.1827046389,	11937.9321132286,	11743.2708881713),
        B2DS=c(	15719.3335363075,	14108.2463665606,	12850.8350492727,	11881.8686912442,	11320.9237556038,	10649.7089952085,	10520.2452541197,	10418.2897087513,	10249.6348231172))
EIAETP2017tfec$Variable <- "Final Energy|Industry"  # in PJ

EIAETP2017=rbind(EIAETP2017ghg, EIAETP2017tfec)
EIAETP2017=gather(EIAETP2017, Scenario, value, by=c("n2DS","B2DS"))
EIAETP2017=data.table(EIAETP2017)

EIAETP2017y2015=data.table(Variable=c("Emissions|CO2|||Industry", "Final Energy|Industry"),
                           Y2015=c(552, 15719))

EIAETP2017=merge(EIAETP2017, EIAETP2017y2015, by=c("Variable"))

EIAETP2017 = EIAETP2017 %>% mutate(ByBL=(value/BL)*100, ByY=(value/Y2015)*100, ByX=(BL/Y2015)*100)
EIAETP2017=data.table(EIAETP2017)
EIAETP2017$Study <- "OECD/IEA (2017b)"
## Emissions efficiency


###### ADAM (p. 231, final energy consumption for EU27 [in PJ])
ADAMtfec=data.table(
  Year=c(2005,2020,2050),
  BL=c(14012,12704, 9797),
  n2DS =c(14012,11174, 6439),
  B2DS=c(14012,11185, 6464)
    )

ADAMtfec=gather(ADAMtfec, Scenario, value, by=c("n2DS", "B2DS", "BL"))
ADAMtfec$Variable <- "Final Energy|Industry"

ADAMghg=data.table(
  Year=c(2005,2020,  2050),
  BL=c(651.53,558.43, 349.94),
  n2DS =c(651.53,509.57, 235.71),
  B2DS=c(651.53,485.94, 209.99)
)
###### ADAM (p. 181, industrial CO2 emissions for EU27 [in Mt])
ADAMghg=gather(ADAMghg, Scenario, value, by=c("n2DS", "B2DS", "BL"))
ADAMghg$Variable <- "Emissions|CO2|||Industry"

ADAM=rbind(ADAMtfec,ADAMghg)
ADAM$Study <- "Schade et al. (2009)"

#Intrapolatie with approximate
ADAM.intrapolate=seq(unique(ADAM$Year)[1],2100) #unique(sdt$Year)[length(unique(sdt$Year))]
ADAM=data.table(ADAM)
ADAMinter = ADAM[,list(approx(x=Year,y=value,xout=ADAM.intrapolate)$y,approx(x=Year,y=value,xout=ADAM.intrapolate)$x),by=c('Scenario','Variable', 'Study')]
setnames(ADAMinter, "V1", "value")
setnames(ADAMinter, "V2", "Year")

ADAM=merge(ADAMinter[!Scenario=="BL"], ADAMinter[Scenario=="BL", -c('Scenario', 'Study')], by=c("Year", 'Variable'), allow.cartesian=TRUE)
setnames(ADAM, "value.x", "value")
setnames(ADAM, "value.y", "BL")


ADAMy=data.table(Variable=c("Emissions|CO2|||Industry", "Final Energy|Industry"),
                 Y2005=c(652, 14012)
)

ADAM=merge(ADAM, ADAMy, by=c("Variable"))

ADAM = ADAM %>% mutate(ByBL=(value/BL)*100, ByY=(value/Y2005)*100, ByX=(BL/Y2005)*100)

####### FRAGKOS et al. (2017)  # Had to calculate Energy with final energy and share of industry
Fragosdata=data.table(Scenario=c(	"BL",	"BL",	"BL",	"n2DS",	"n2DS",	"n2DS"),
                      Year=c(	2010,	2030,	2050,	2010,	2030,	2050),
                       Emissions=c(	520,	484,	425,	520,	453,	193),
                       Energy=c(	290.658,	307.398,	309.619,	290.658,	295.075,	251.908))
                                                     
Fragosdata=gather(Fragosdata, Variable, value, c("Emissions", "Energy"))
Fragosdata=data.table(Fragosdata)
Fragosdata2010=data.table(Variable=c("Emissions", "Energy"),
                          Y2010=c(520,290.658))
Fragosdatacalc=merge(Fragosdata, Fragosdata2010, by=c("Variable"))

Fragosdatacalc=merge(Fragosdatacalc, Fragosdata[Scenario=="BL", -c("Scenario")], by=c("Year", "Variable"))
setnames(Fragosdatacalc, "value.x", "value")
setnames(Fragosdatacalc, "value.y", "BL")

Fragosdatacalc=Fragosdatacalc %>% mutate(ByY=(value/Y2010)*100, ByBL=(value/BL)*100, ByX=(BL/Y2010)*100)
Fragosdatacalc$Study <- "Fragkos et al. (2017)"
Fragosdatacalc=data.table(Fragosdatacalc)
Fragosdatacalc=Fragosdatacalc[Variable=="Energy", Variable:=("Final Energy|Industry")]
Fragosdatacalc=Fragosdatacalc[Variable=="Emissions", Variable:=("Emissions|CO2|||Industry")]

#################################################################################
# Emissions efficiency = G/E  (Mtonne/PJ)

EMF28meltEUEmeff=EMF28meltEU.stand[Variable %in% c("Final Energy|Industry", "Emissions|CO2|||Industry"), -c("Unit","BL", "ByBL", "ByY", "Y2005")]
EMF28meltEUEmeff=spread(EMF28meltEUEmeff, Variable, value)
setnames(EMF28meltEUEmeff, "Final Energy|Industry", "TFEC")
setnames(EMF28meltEUEmeff, "Emissions|CO2|||Industry", "GHG")
EMF28meltEUEmeff=EMF28meltEUEmeff %>% mutate(Index=(GHG/TFEC))
EMF28meltEUEmeff=data.table(EMF28meltEUEmeff)
EMF28meltEUEmeffBL=EMF28meltEUEmeff[Scenario=="EU1"]
EMF28meltEUEmeff2015=EMF28meltEUEmeff[Year=="2015"]
EMF28meltEUEmeff=merge(EMF28meltEUEmeff, EMF28meltEUEmeffBL[, c("Model", "Year", "Index")], by=c("Model", "Year"))
EMF28meltEUEmeff=merge(EMF28meltEUEmeff, EMF28meltEUEmeff2015[, c("Model", "Scenario", "Index")], by=c("Model", "Scenario"))
EMF28meltEUEmeff=EMF28meltEUEmeff %>% mutate(ByBL=(Index.x/Index.y)*100, ByY=(Index.x/Index)*100)
EMF28meltEUEmeff=data.table(EMF28meltEUEmeff)
EMF28meltEUEmeff$Study <- "Förster et al. (2013)"
EMF28meltEUEmeff$Variable <- "Emissions intensity"

#ADAMemeff=merge(ADAMghg, ADAMtfec, by=c("Year", "Scenario"))
ADAM=data.table(ADAM)
ADAMemeff=merge(ADAM[Variable=="Emissions|CO2|||Industry"], ADAM[Variable=="Final Energy|Industry"], by=c("Year", "Scenario", "Study"))
ADAMemeff=ADAMemeff %>% mutate(BLemeff=((BL.x*1000)/BL.y), B2DSemeff=((value.x*1000)/value.y))  #Makes kgram/J)
ADAMemeff=gather(ADAMemeff, Emeff, value, by=c("BLemeff", "B2DSemeff"))
ADAMemeff=ADAMemeff[,c("Year", "Scenario", "Study", "Emeff", "value")]
ADAMemeff$Variable <- "Emissions intensity"
ADAMemeff$Study <- "Schade et al. (2009)"
ADAMemeff=data.table(ADAMemeff)
ADAMemeff=ADAMemeff[Emeff=="BLemeff", Scenario:=c("BL")]
ADAMemeff=unique(ADAMemeff)
ADAMemeff=merge(ADAMemeff, ADAMemeff[Scenario=="BL"], by=c("Year","Variable", "Study"),allow.cartesian=TRUE)
ADAMemeff$Y2005 <- 46.49800
ADAMemeff=ADAMemeff %>% mutate(ByBL=(value.x/value.y)*100, ByY=(value.x/Y2005)*100)
ADAMemeff=data.table(ADAMemeff)

#Fragkos et al. (2017)
FRAGKOSemeff=merge(Fragosdatacalc[Variable=="Emissions|CO2|||Industry"], Fragosdatacalc[Variable=="Final Energy|Industry"], by=c("Year", "Scenario", "Study"))
FRAGKOSemeff=FRAGKOSemeff %>% mutate(BLemeff=((BL.x)/BL.y*41.87), B2DSemeff=((value.x)/value.y*41.87))  #MtonCO2/Mtoe #Makes kgram/ kJ (???)
FRAGKOSemeff=gather(FRAGKOSemeff, Emeff, value, by=c("BLemeff", "B2DSemeff"))
FRAGKOSemeff=FRAGKOSemeff[,c("Year", "Scenario", "Study", "Emeff", "value")]
FRAGKOSemeff$Variable <- "Emissions intensity"
FRAGKOSemeff$Study <- "Frqagkos et al. (2017)"
FRAGKOSemeff=data.table(FRAGKOSemeff)
FRAGKOSemeff=FRAGKOSemeff[Emeff=="BLemeff", Scenario:=c("BL")]
FRAGKOSemeff=unique(FRAGKOSemeff)
FRAGKOSemeff=merge(FRAGKOSemeff, FRAGKOSemeff[Scenario=="BL"], by=c("Year","Variable", "Study", "Emeff"),allow.cartesian=TRUE)
setnames(FRAGKOSemeff,"value.y", "BL")
FRAGKOSemeff=data.table(FRAGKOSemeff)
FRAGKOSemeff$Y2010 <- 75
FRAGKOSemeff=FRAGKOSemeff %>% mutate(ByBL=(value.x/BL)*100, ByY=(value.x/Y2010)*100)
FRAGKOSemeff=data.table(FRAGKOSemeff)
#


#IEA
EIAETP2017emeff=rbind(EIAETP2017ghg, EIAETP2017tfec)
EIAETP2017emeff=gather(EIAETP2017emeff, Scenario, value, by=c("n2DS", "BL", "B2DS"))
EIAETP2017emeff=spread(EIAETP2017emeff, Variable, value)
setnames(EIAETP2017emeff, "Final Energy|Industry", "TFEC") # in EJ/yr
setnames(EIAETP2017emeff, "Emissions|CO2|||Industry", "GHG")  # Mt CO2/yr
EIAETP2017emeff=EIAETP2017emeff %>% mutate(Emeff=((GHG*1000)/TFEC))
EIAETP2017emeff$Variable  <- "Emissions intensity"
EIAETP2017emeff$Study <- "OECD/IEA (2017b)"
EIAETP2017emeff=data.table(EIAETP2017emeff)
EIAETP2017emeff=merge(EIAETP2017emeff, EIAETP2017emeff[Scenario=="BL", -c("TFEC","GHG")], by=c("Year", "Variable", "Study"))
EIAETP2017emeff$Y2014 <- 35.10810
EIAETP2017emeff=EIAETP2017emeff %>% mutate(ByBL=(Emeff.x/Emeff.y)*100, ByY=(Emeff.x/Y2014)*100)
EIAETP2017emeff=data.table(EIAETP2017emeff)


### Energy intensity (E/$)
EMF28meltEU=data.table(EMF28meltEU)
EMF28meltEUVAI=merge(EMF28meltEU[Variable=="Final Energy|Industry"], EMF28meltEU[Variable=="Value Added|Industry", -c("Variable", "BL", "Y2005")], by=c("Model", "Scenario", "Region", "Year"))
setnames(EMF28meltEUVAI, "value.y", "VA")
EMF28meltEUVAI=EMF28meltEUVAI %>% mutate(VAI=((value.x/VA)))
EMF28meltEUVAI=data.table(EMF28meltEUVAI)
EMF28meltEUVAI=merge(EMF28meltEUVAI, EMF28meltEUVAI[Scenario=="EU11", -c("Scenario",  "Y2005", "BL", "value.x", "VA", "Unit.x", "Unit.y", "Variable.x", "Variable.y")], by=c("Model", "Year", "Region"))
setnames(EMF28meltEUVAI, "VAI.y", "BLvai")
EMF28meltEUVAI=merge(EMF28meltEUVAI, EMF28meltEUVAI[Year=="2010", -c("Year",  "Y2005", "BL", "value.x", "VA", "BLvai", "Unit.x", "Unit.y", "Variable.x", "Variable.y")], by=c("Model", "Scenario", "Region"))

setnames(EMF28meltEUVAI, "VAI.x.y", "Y2010vai")
setnames(EMF28meltEUVAI, "VAI.x.x", "VAI")
EMF28meltEUVAI=EMF28meltEUVAI %>% mutate(ByBL=((VAI/BLvai)*100), ByY=((VAI/Y2010vai)*100))
EMF28meltEUVAI=data.table(EMF28meltEUVAI)
EMF28meltEUVAI$Study <- "Förster et al. (2013)"
EMF28meltEUVAI=EMF28meltEUVAI[Variable.x=="Final Energy|Industry",Variable.x:=("Energy intensity")]
setnames(EMF28meltEUVAI, "Variable.x", "Variable")
###############

# Cross-section Energy intensity vs Carbon intensity

EMF28carbeneff=merge(EMF28meltEUVAI, EMF28meltEUEmeff[,-c("GHG", "TFEC", "Index.x", "Index.y", "Index", "Region")], by=c("Model", "Scenario", "Year"))
setnames(EMF28carbeneff, "ByBL.x", "ByBLeff")
setnames(EMF28carbeneff, "ByY.x", "ByYeff")
setnames(EMF28carbeneff, "ByBL.y", "ByBLdecarb")
setnames(EMF28carbeneff, "ByY.y", "ByYdecarb")

EMF28carbeneff$group <-paste(EMF28carbeneff$Model, EMF28carbeneff$Scenario, EMF28carbeneff$Year)

# Linear and compound rate reductions for energy intensity improvements
EMF28meltEUVAIrate=EMF28meltEUVAI
EMF28meltEUVAIrate=EMF28meltEUVAIrate[, c("Model", "Scenario", "Region", "Year", "Variable", "ByBL", "ByY")]
EMF28meltEUVAIratecalc1=merge(EMF28meltEUVAIrate[Year=="2010"],EMF28meltEUVAIrate[Year %in% c("2030")], by=c("Model", "Scenario", "Region", "Variable"))
EMF28meltEUVAIratecalc2=merge(EMF28meltEUVAIrate[Year=="2030"],EMF28meltEUVAIrate[Year %in% c("2050")], by=c("Model", "Scenario", "Region", "Variable"))
EMF28meltEUVAIratecalc=rbind(EMF28meltEUVAIratecalc1, EMF28meltEUVAIratecalc2)


EMF28meltEUVAIratelinear=EMF28meltEUVAIratecalc %>% mutate(ByBLc=(ByBL.x-ByBL.y)/(Year.y-Year.x), ByBYc=(ByY.x-ByY.y)/(Year.y-Year.x))
EMF28meltEUVAIratelinear <- na.omit(EMF28meltEUVAIratelinear)
EMF28meltEUVAIratelinear=data.table(EMF28meltEUVAIratelinear)
EMF28meltEUVAIratelinearminmaxBL=EMF28meltEUVAIratelinear[,list(ymax=max(ByBLc,na.rm = TRUE),ymin=min(ByBLc,na.rm = TRUE)),by=c("Scenario", "Year.y")]
EMF28meltEUVAIratelinearminmaxBY=EMF28meltEUVAIratelinear[,list(ymax=max(ByBYc,na.rm = TRUE),ymin=min(ByBYc,na.rm = TRUE)),by=c("Scenario", "Year.y")]
EMF28meltEUVAIratelinearminmaxBY$Group <- "Linear rate"
EMF28meltEUVAIratelinearminmaxBY$Indicator <- "Energy efficiency"

EMF28meltEUVAIratecompound=EMF28meltEUVAIratecalc %>% mutate(ByBLc=(1-((ByBL.y/ByBL.x)^(1/(Year.y-Year.x))))*100, ByBYc=(1-((ByY.y/ByY.x)^(1/(Year.y-Year.x))))*100)
EMF28meltEUVAIratecompound <- na.omit(EMF28meltEUVAIratecompound)
EMF28meltEUVAIratecompound=data.table(EMF28meltEUVAIratecompound)
EMF28meltEUVAIratecompoundminmaxBL=EMF28meltEUVAIratecompound[,list(ymax=max(ByBLc,na.rm = TRUE),ymin=min(ByBLc,na.rm = TRUE)),by=c("Scenario", "Year.y")]
EMF28meltEUVAIratecompoundminmaxBY=EMF28meltEUVAIratecompound[,list(ymax=max(ByBYc,na.rm = TRUE),ymin=min(ByBYc,na.rm = TRUE)),by=c("Scenario", "Year.y")]
EMF28meltEUVAIratecompoundminmaxBY$Group <- "Compound rate"
EMF28meltEUVAIratecompoundminmaxBY$Indicator <- "Energy efficiency"

# Linear and compound rate reductions for carbon intensity improvements
# original base year is 2005........
ADAMemeffnew=ADAMemeff
ADAMemeffnew=ADAMemeffnew[,c("Year", "Variable",  "Scenario.x", "ByBL", "ByY")]
ADAMemeffnew=ADAMemeffnew[Scenario.x %in% c( "n2DS", "B2DS"), Scenario.x:=("EU9")]
ADAMemeffnew=ADAMemeffnew[Scenario.x %in% c("BL"), Scenario.x:=("EU11")]
ADAMemeffnew$Model <- "ADAM"

## Fragkos et al.
FRAGKOSemeffnew=FRAGKOSemeff
FRAGKOSemeffnew=FRAGKOSemeffnew[,c("Year", "Variable",  "Scenario.x", "ByBL", "ByY")]
FRAGKOSemeffnew=FRAGKOSemeffnew[Scenario.x %in% c( "n2DS", "B2DS"), Scenario.x:=("EU9")]
FRAGKOSemeffnew=FRAGKOSemeffnew[Scenario.x %in% c("BL"), Scenario.x:=("EU11")]
FRAGKOSemeffnew$Model <- "FRAGKOS"

# original base year is 2014........
EIAETP2017emeffnew=EIAETP2017emeff[Year=="2014", Year:=(2010)]
EIAETP2017emeffnew=EIAETP2017emeffnew[Scenario.x %in% c( "n2DS", "B2DS"), Scenario.x:=("EU9")]
EIAETP2017emeffnew=EIAETP2017emeffnew[Scenario.x %in% c("BL"), Scenario.x:=("EU11")]
EIAETP2017emeffnew=EIAETP2017emeffnew[,c("Year", "Variable", "Scenario.x", "ByBL", "ByY")]
EIAETP2017emeffnew$Model <- "IEA"

EMISINTENSOTHER=rbind(ADAMemeffnew,EIAETP2017emeffnew, FRAGKOSemeffnew)
setnames(EMISINTENSOTHER, "Scenario.x", "Scenario")

EMF28meltEUEmeffrate=EMF28meltEUEmeff
EMF28meltEUEmeffrate=EMF28meltEUEmeffrate[, c("Model", "Scenario", "Year", "Variable", "ByBL", "ByY")]
EMF28meltEUEmeffrate=rbind(EMF28meltEUEmeffrate,EMISINTENSOTHER)
EMF28meltEUEmeffratecalc1=merge(EMF28meltEUEmeffrate[Year=="2010"],EMF28meltEUEmeffrate[Year %in% c("2030")], by=c("Model", "Scenario", "Variable"), allow.cartesian = T)
EMF28meltEUEmeffratecalc2=merge(EMF28meltEUEmeffrate[Year=="2030"],EMF28meltEUEmeffrate[Year %in% c("2050")], by=c("Model", "Scenario", "Variable"))
EMF28meltEUEmeffratecalc=rbind(EMF28meltEUEmeffratecalc1, EMF28meltEUEmeffratecalc2)
EMF28meltEUEmeffratecalc=unique(EMF28meltEUEmeffratecalc)


EMF28meltEUEmeffratelinear=EMF28meltEUEmeffratecalc %>% mutate(ByBLc=(ByBL.x-ByBL.y)/(Year.y-Year.x), ByBYc=(ByY.x-ByY.y)/(Year.y-Year.x))
EMF28meltEUEmeffratelinear <- na.omit(EMF28meltEUEmeffratelinear)
EMF28meltEUEmeffratelinear=data.table(EMF28meltEUEmeffratelinear)
EMF28meltEUEmeffratelinear$Group <- "Linear rate"
EMF28meltEUEmeffratelinear$Indicator <- "Emissions efficiency"
EMF28meltEUEmeffratelinearminmaxBL=EMF28meltEUEmeffratelinear[!Model %in% c("ADAM", "IEA"),list(ymax=max(ByBLc,na.rm = TRUE),ymin=min(ByBLc,na.rm = TRUE)),by=c("Scenario", "Year.y", "Group", "Indicator")]
EMF28meltEUEmeffratelinearminmaxBY=EMF28meltEUEmeffratelinear[!Model %in% c("ADAM", "IEA"),list(ymax=max(ByBYc,na.rm = TRUE),ymin=min(ByBYc,na.rm = TRUE)),by=c("Scenario", "Year.y", "Group", "Indicator")]


EMF28meltEUEmeffratecompound=EMF28meltEUEmeffratecalc %>% mutate(ByBLc=(1-((ByBL.y/ByBL.x)^(1/(Year.y-Year.x))))*100, ByBYc=(1-((ByY.y/ByY.x)^(1/(Year.y-Year.x))))*100)
EMF28meltEUEmeffratecompound <- na.omit(EMF28meltEUEmeffratecompound)
EMF28meltEUEmeffratecompound=data.table(EMF28meltEUEmeffratecompound)
EMF28meltEUEmeffratecompound$Group <- "Compound rate"
EMF28meltEUEmeffratecompound$Indicator <- "Emissions efficiency"
EMF28meltEUEmeffratecompoundminmaxBL=EMF28meltEUEmeffratecompound[!Model %in% c("ADAM", "IEA"),list(ymax=max(ByBLc,na.rm = TRUE),ymin=min(ByBLc,na.rm = TRUE)),by=c("Scenario", "Year.y", "Group", "Indicator")]
EMF28meltEUEmeffratecompoundminmaxBY=EMF28meltEUEmeffratecompound[!Model %in% c("ADAM", "IEA"),list(ymax=max(ByBYc,na.rm = TRUE),ymin=min(ByBYc,na.rm = TRUE)),by=c("Scenario", "Year.y", "Group", "Indicator")]





```

Decarbonization strategies {.tabset .tabset-fade}
-------------------------------------

Most long-term integrative assessment studies are less detailed about industrial decarbonisation strategies and describe response strategies in more aggregate indicators. Only a more limited set of studies have assessed industrial decarbonisation strategies in Europe more explicitly (see Table). We use the data of these studies on this page

Study | Shortname
------|--------
[Förster et al. (2013) ](https://emf.stanford.edu/projects/emf-28-effects-technology-choices-eu-climate-policy) | EMF28
[Schade et al. (2009)]()  | ADAM
[OECD/IEA (2017)]() | IEA
[Fragkos et al. (2013)]() | FRAGKOS

Most of the industrial improvement depictions in Förster et al. (2013) assume energy efficiency
improvements in the short-term (until 2030) for both the policy baseline and decarbonisation
scenarios. The average annual decline in energy demand is largest early on in the century for both scenarios, but the relative annual reductions are higher in decarbonisation scenarios later on in the century. Until 2030, annual efficiency improvements of about -0.7% to 2% (compound rate, baseline) or 1.7% to 4% (compound rate, decarbonisation) are projected in Förster et al. (2013), while this rate increases to 2% to 5% under decarbonisation assumptions in the period from 2030 to 2050. This equates to a decades-long sustained energy efficiency improvement of 1 to 3 times the current rate, which has only been observed incidentally in emerging economies to date (e.g. China, with a 5.6% rate in 2015 (OECD/IEA, 2016)).

The emission intensity improvements in decarbonisation strategies have a smaller contribution in the short term (ranging from 0%-1%) than later in the century (0.2% to 5%, for which compound rates are higher than linear rates over a sustained period). The rates of change in Förster et al. (2013) are broadly in agreement with the other studies (Schade et al. 2009, OECD/IEA 2017b, Fragkos et al. 2007). This reflects the fact that only in a policy scenario with stringent climate policy, and only after 2030, more aggressive emission efficiency measures are adopted. The scenarios in Figure 8 project emissions intensities of between 40-60 g CO<sub>2</sub>/kJ (Förster et al., 2013) by 2050. These are higher than in other European studies, depicting carbon intensities of 13-20 g CO<sub>2</sub>/kJ (OECD/IEA, 2017), 32-36 g CO<sub>2</sub>/kJ (Schade et al., 2009) and 32 g CO2/kJ (Fragkos et al., 2017) for the same year.
    
### Decarbonisation pathway
  
```{r results=TRUE, message=FALSE, warning=FALSE, echo=FALSE}

EMF28carbeneffplot=EMF28carbeneff[, c("Scenario", "Model", "Year","ByYeff", "ByYdecarb")]
EMF28carbeneffplot=na.omit(EMF28carbeneffplot)

# By base year (2010)
CROSSSECTIONby=ggplot() +
  geom_line(data=EMF28carbeneffplot[Scenario=="EU9"], aes(y=ByYeff, x=ByYdecarb, group=Model, colour=Scenario), alpha=0.8, size=1) +   # scatter plot geometric 
  geom_text(data=EMF28carbeneffplot[Scenario=="EU9" & Year %in% c("2010", "2030","2050")],  aes(y=ByYeff, x=ByYdecarb+2, label=(Year)), show.legend=F, size=3) +   # scatter plot geometric 
  
  geom_line(data=EMF28carbeneffplot[Scenario=="EU11"], aes(y=ByYeff, x=ByYdecarb, group=Model, colour=Scenario), alpha=0.8, size=1) +   # scatter plot geometric 
  geom_text(data=EMF28carbeneffplot[Scenario=="EU11" & Year %in% c("2010", "2030","2050")],  aes(y=ByYeff, x=ByYdecarb+2, label=(Year)), show.legend=F, size=3) +   # scatter plot geometric 
  
  # geom_point(data=EMF28carbeneff[Scenario=="EU9" & Year %in% c("2050")], stat = "identity", size=8, aes(y=ByYeff, x=ByYdecarb, color=Model, fill=Model), shape=21, alpha=0.2) +   # scatter plot geometric 
  # geom_text(data=EMF28carbeneff[Scenario=="EU9" & Year %in% c("2050")],  aes(y=ByYeff, x=ByYdecarb, label=(substr(Model,1, stop=2)), color=Model), show.legend=F) +   # scatter plot geometric 
  # 
  
  geom_abline(intercept = 0, slope = 1, linetype="dotted")       +                                       # dividing line
  geom_abline(intercept = 0, slope = 0, linetype="dotted")    +                                          # Y=0 line
  geom_vline(xintercept=c(0,0), linetype="dotted")   +                                 # hit ?linetype for variations
  #facet_wrap(~Variable, ncol=1) +
  coord_cartesian(xlim=c(0:100), ylim=c(0:140)) +
  theme_bw() +
  ggtitle("Decarbonisation strategies", subtitle="Compared to base year (2010)") +
  labs(y="Change in energy productivity (E/GVA) ", x = "Change in emission intensity (GHG/E)") +
  guides(fill=guide_legend("Sector"))+
  scale_colour_manual(values=c("#4bbff2","#a5ae64"),
                      breaks=c("EU11", "EU9"),
                      labels = c("Baseline",
                                 "Decarbonisation")) +
  theme_bw()     +
        theme(
        axis.text.x = element_text(angle = 45, size=14,  hjust=1),
        axis.title.y = element_text(size=13),
        axis.title.x = element_text(size=13),
        axis.text.y = element_text(size=12),
        strip.text.x = element_text(size=12, face="bold"),
        strip.text.y = element_text(size=12, face="bold"),
        legend.text= element_text(size=12),
        legend.title=element_text(size=13,  face="bold"),
        plot.title=element_text(size=16, hjust=0.5, face="bold"), 
        plot.subtitle=element_text(size=14,hjust=0.5),
        panel.border = element_rect(colour = "black", size=1),
        legend.key =  element_rect(fill = 'white', size = 0.5),
        strip.background = element_rect(colour="white", fill="#FFFFFF")
            ) 

ggplotly(CROSSSECTIONby) 


```

    
### Average rate of change

  
```{r results=TRUE, message=FALSE, warning=FALSE, echo=FALSE}


## BAR chart
BARCHARTby=ggplot() +
  geom_crossbar(data=EMF28meltEUVAIratecompoundminmaxBY[Scenario %in% c("EU11", "EU9")], aes(x=as.factor(Year.y), ymin=ymin, ymax=ymax, y=(ymax/2), fill=Scenario), colour=NA, width=0.5, position=position_dodge(width=0.8))+
  geom_crossbar(data=EMF28meltEUVAIratelinearminmaxBY[Scenario %in% c("EU11", "EU9")], aes(x=as.factor(Year.y), ymin=ymin, ymax=ymax, y=(ymax/2), fill=Scenario), colour=NA, width=0.5, position=position_dodge(width=0.8))+
  
  geom_crossbar(data=EMF28meltEUEmeffratelinearminmaxBY[Scenario %in% c("EU11", "EU9")], aes(x=as.factor(Year.y), ymin=ymin, ymax=ymax, y=(ymax/2), fill=Scenario), colour=NA, width=0.5, position=position_dodge(width=0.8))+
  geom_crossbar(data=EMF28meltEUEmeffratecompoundminmaxBY[Scenario %in% c("EU11", "EU9")], aes(x=as.factor(Year.y), ymin=ymin, ymax=ymax, y=(ymax/2), fill=Scenario), colour=NA, width=0.5, position=position_dodge(width=0.8))+
  
  geom_point(data=EMF28meltEUEmeffratecompound[Model %in% c("ADAM")], aes(x=as.factor(Year.y), y=ByBYc, shape=Model, fill=Scenario), size=2,position=position_dodge(width=0.8)) +
  geom_point(data=EMF28meltEUEmeffratelinear[Model %in% c("ADAM")], aes(x=as.factor(Year.y), y=ByBYc, shape=Model, fill=Scenario),size=2, position=position_dodge(width=0.8)) +
  geom_point(data=EMF28meltEUEmeffratecompound[Model %in% c("IEA")], aes(x=as.factor(Year.y), y=ByBYc, shape=Model, fill=Scenario), size=2,position=position_dodge(width=0.8)) +
  geom_point(data=EMF28meltEUEmeffratelinear[Model %in% c("IEA")], aes(x=as.factor(Year.y), y=ByBYc, shape=Model, fill=Scenario),size=2, position=position_dodge(width=0.8)) +
  geom_point(data=EMF28meltEUEmeffratecompound[Model %in% c("FRAGKOS")], aes(x=as.factor(Year.y), y=ByBYc, shape=Model, fill=Scenario), size=2,position=position_dodge(width=0.8)) +
  geom_point(data=EMF28meltEUEmeffratelinear[Model %in% c("FRAGKOS")], aes(x=as.factor(Year.y), y=ByBYc, shape=Model, fill=Scenario),size=2, position=position_dodge(width=0.8)) +
  
  facet_grid(Indicator~Group) +
  
  ggtitle("Efficiency improvement rate") +
  labs(y="Efficiency improvement (%/p.a.)", x = "Year") +
  guides(fill=guide_legend("Sector"))+
  scale_fill_manual(values=c("#4bbff2","#a5ae64"),
                      breaks=c("EU11", "EU9"),
                      labels = c("Baseline",
                                 "Decarbonisation")) +
  scale_x_discrete(limits=c("2030", "2050"),
                   labels=c("2010- \n 2030", "2030- \n 2050")) +
  scale_shape_manual(values=c(25,24,23),
                     breaks=c("ADAM", "IEA", "FRAGKOS"),
                     labels = c("Schade et al. (2009)",
                                "OECD/IEA (2017b)",
                                "Fragkos et al. (2017)")) +
  guides(fill=guide_legend(override.aes=list(shape=NA)),
         shape=guide_legend("Other studies")) +
  theme_bw()     +
        theme(
        axis.text.x = element_text(angle = 45, size=14,  hjust=1),
        axis.title.y = element_text(size=13),
        axis.title.x = element_text(size=13),
        axis.text.y = element_text(size=12),
        strip.text.x = element_text(size=12, face="bold"),
        strip.text.y = element_text(size=12, face="bold"),
        legend.text= element_text(size=12),
        legend.title=element_text(size=13,  face="bold"),
        plot.title=element_text(size=16, hjust=0.5, face="bold"), 
        plot.subtitle=element_text(size=14,hjust=0.5),
        panel.border = element_rect(colour = "black", size=1),
        legend.key =  element_rect(fill = 'white', size = 0.5),
        strip.background = element_rect(colour="white", fill="#FFFFFF")
            ) 

ggplotly(BARCHARTby)
```

   
 
-------------------------------------
  
## Emission and energy efficiency rate p.a.



```{r echo=FALSE}

DT::datatable(EMF28carbeneffplot[Scenario %in% c("EU9", "EU11")], options = list(
  pageLength = 10
))

```
  